**通用定时器特性**

- 输入捕获
- 输出比较
- 完全独立

<br/>

<br/>

## TIM2~TIM5

<br/>

### 0x01、基础特性

<img src="pic/efbfac938fc50627e4ab44620be3d6e9.png" alt="截图" style="zoom:50%;" />

- 4个通道
- 16位分频器
- 自动重载计数器（16位：TIM3 TIM4）（32位：TIM2 TIM5）

<br/>

### 0x02、框图 寄存器

![截图](pic/2c57f165d68293e2c3965cdb0858117c.png)

<br/>

<img src="pic/5d4e38df601b4a1e93ab7d0d54bbf4ae.png" alt="截图" style="zoom:50%;" />

<img src="pic/4632247c898cfd673eaac6532b0a407d.png" alt="截图" style="zoom:50%;" />

<img src="pic/60738290681f9853f0f1aa5c68600e93.png" alt="截图" style="zoom:50%;" />

<br/>

<br/>

<br/>

<br/>

### 0x03、时钟信号

![截图](pic/3a31d8f2bdf0ac6a83f685662051b1bf.png)

<br/>

- 内部时钟
  
  <img src="pic/eeb4e801021a543c0000f6b2586b18d2.png" alt="截图" style="zoom:50%;" />

- 外部时钟模式1

<img src="pic/5382c1e44c0bd83367ec6e5ea7145258.png" alt="截图" style="zoom:50%;" />

- 外部时钟模式2

<img src="pic/33e3517c96cc444fa054e6e615f040d0.png" alt="截图" style="zoom:50%;" />

<br/>

### 0x04、如何选择时钟源

<br/>

**通常情况下都默认使用内部时钟**

<br/>

- 使用内部时钟
  
  <br/>
  
  <img src="pic/49230dae270b78e31c15b4ae229e06d3.png" alt="截图" style="zoom:50%;" />
  
  <img src="pic/b93a7de4e3c2e13519b9d41745d47ba1.png" alt="截图" style="zoom:50%;" />

- 使用外部1

<img src="pic/ba468e17c269667254f181daebe09478.png" alt="截图" style="zoom:50%;" />

- 使用外部2

<img src="pic/369a13f8a6aef586017f26f6f06f023b.png" alt="截图" style="zoom:50%;" />

<br/>

<br/>

### 0x05、时钟信号滤波

只有外部时钟信号才需要滤波步骤（输入捕获）

<img src="pic/cc5af6b7c09848b49e496c4be0e04fbb.png" alt="截图" style="zoom:50%;" />

<img src="pic/fceb236a550a504f8c027a964001fc47.png" alt="截图" style="zoom:50%;" />

<img src="pic/e925206e21029b5fb10150069347e53c.png" alt="截图" style="zoom:50%;" />

输出比较时CKD配置为00，因为后面步骤还有分频，这里的分频针对ETR外部时钟

<br/>

### 0x06、外部时钟1的信号源

<br/>

#### a、信号源种类

- ITRx（定时器级联）
- TI1F_ED（输入捕获通道1不经过滤波）
- TI1FP1（输入捕获通道1经过滤波）
- TI2FP2（输入捕获通道2经过滤波）
- ETRF（外部时钟模式2的信号）

<img src="pic/7f144217a6222b3d38542f432a8a0f61.png" alt="截图" style="zoom:50%;" />

#### b、信号源配置

<img src="pic/6830c707144422da15eee4f4810a413e.png" alt="截图" style="zoom:50%;" />

<img src="pic/f16cd83667fb36c35f7cddc65999ebc7.png" alt="截图" style="zoom:50%;" />

<img src="pic/e9cbf9a93af4bed452c3da4c99322a39.png" alt="截图" style="zoom:50%;" />

#### c、时钟信号级联配置

![截图](pic/a57e93b6dc0e1f49edf31199571167ba.png)

![截图](pic/f81c870008aa78b628da7b60e9e71f56.png)

<br/>

<br/>

### 0x07、输出比较

通常指的是PWM，高低电平的周期时间比例

#### TIMxCR1控制寄存器1

![截图](pic/6f7ace83913710dfb9ae71f4f9c885fe.png)![截图](pic/95660ca4b4ab16389d8647116ddd0749.png)![截图](pic/2fd458870bdb5c273929829d1db24a19.png)![截图](pic/8bb40e9f7b4e1c66d078a54b277752d5.png)![截图](pic/309bdcd9e0946f05b2d66f92fd89e556.png)

注意：①CKD时钟分频是针对外部输入ETR时分频滤波使用（输入捕获）

          ②常规情况配置使用缓存，保证完整性（在计数中途不被程序写入覆盖）

<br/>

<br/>

#### TIMx_SMCR从模式控制寄存器

![截图](pic/c7688a2c42a4694e4283db5e16e59914.png)![截图](pic/888437d54268948585fe2d30bbe56ad4.png)![截图](pic/dabefe43e22f6e2354f26c7a27d646c9.png)![截图](pic/d2c79247adc465bce4ab183d89723996.png)![截图](pic/a1d4edbc54b3b590e722bfc247182822.png)

<br/>

<br/>

<br/>

#### TIMx_CCMR1捕获/比较模式寄存器1

![截图](pic/2fab90c6d143e4bb18299f620e034efe.png)

<br/>

#### TIMxCCER捕获/比较使能寄存器

![截图](pic/73af1967ffcfb27408fb4654263d0a0a.png)

<br/>

#### TIMxPSC预分频器

![截图](pic/ac8c8648eb02778b985dd35af546f861.png)

<br/>

#### TIMxARR自动重载寄存器

![截图](pic/bd5c7d809970ab2ae45474be1829f1d4.png)

<br/>

#### TIMx捕获/比较寄存器1

![截图](pic/af8d00447a36c13f59820b289587aca9.png)

<br/>

#### TIMx时间生成寄存器

![截图](pic/ced3cb4083d80e7142469efc5052d19c.png)

<br/>

#### 配置步骤示例

1. 配置CR1寄存器的分频
   1. 捕获模式时默认配置
   2. 比较模式时由于是外部输入源，需要滤波和分频以提高采样率
2. 

<br/>

<br/>

<br/>

#### PWM模式

![截图](pic/bf3e14461c913cd7ab924039c9d78104.png)

![截图](pic/efe78e04f337aaac36fca32d09f88e26.png)

![截图](pic/d00dd4e8e33145dc435868364c8b89dd.png)

<br/>

<br/>

<br/>

<br/>

## TIM9、TIM12

<br/>

### 0x01、基本特性

<img src="pic/d7d4313d3c7c469bf1d3556ef88c71b1.png" alt="截图" style="zoom:50%;" />

- 两个通道
- 16位自动重载计数器
- 16位分频器

<br/>

### 0x02、框图 寄存器

<br/>

<img src="pic/8c4eecffa78228703aa8ebbd5cb6eec4.png" alt="截图" style="zoom:50%;" />

<br/>

<br/>

<br/>

<br/>

<br/>

## TIM10、TIM11、TIM13、TIM14

<br/>

### 0x01、基本特性

<img src="pic/96ef431dea78f234c2a6f9261a7ceb8c.png" alt="截图" style="zoom:50%;" />

- 一个通道

<br/>

### 0x02、框图

<img src="pic/b1a37d0c450059f2e9a4c1fcba56af06.png" alt="截图" style="zoom:50%;" />