了解如何查看Linux驱动日志对于排查硬件问题、调试驱动或监控系统状态很有帮助。Linux驱动日志主要记录在内核日志中。

### 📖 1. 使用 `dmesg` 命令
`dmesg` 是直接查看内核环形缓冲区（kernel ring buffer）内容的工具，驱动加载、运行和故障信息常会出现在这里。
-   **基本使用**：
    ```bash
    sudo dmesg
    ```
-   **实时监控新日志**（某些版本支持）：
    ```bash
    sudo dmesg --follow
    ```
-   **筛选驱动相关消息**（将 `your_driver_name` 替换为驱动关键词，如 `usb`、`i2c` 等）：
    ```bash
    sudo dmesg | grep -i "your_driver_name"
    sudo dmesg | grep -i "error"  # 查找错误
    ```

### 📋 2. 使用 `journalctl` 命令
在使用 `systemd` 的Linux发行版（如Ubuntu、CentOS 7+等）中，`journalctl` 能查询系统日志，包括内核日志。
-   **查看所有内核日志**：
    ```bash
    sudo journalctl -k
    ```
-   **按时间筛选**：
    ```bash
    sudo journalctl -k --since="2024-12-20 10:00:00" --until="2024-12-20 12:00:00"
    ```
-   **追踪实时日志**：
    ```bash
    sudo journalctl -k -f
    ```
-   **按驱动或模块名筛选**：
    ```bash
    sudo journalctl -k _TRANSPORT=kernel | grep -i "your_driver_name"
    ```

### 📁 3. 查看日志文件
系统日志服务（如 `rsyslog`）通常会将内核日志保存到特定文件中。
-   **常见日志文件位置**：
    -   `/var/log/kern.log`：专门记录内核日志。
    -   `/var/log/syslog`：记录系统日志，包括内核信息。
    -   `/var/log/messages`：在一些发行版（如RHEL/CentOS）中记录系统消息。
-   **使用 `grep` 筛选**：
    ```bash
    sudo grep -i "your_driver_name" /var/log/kern.log
    sudo tail -f /var/log/kern.log  # 实时追踪日志尾部
    ```

### 🔍 4. 其他相关命令
-   **查看已加载模块**：使用 `lsmod` 命令可以列出当前加载的所有内核模块，包括驱动模块。
    ```bash
    lsmod
    ```
-   **查看模块信息**：使用 `modinfo` 命令可以查看特定内核模块的详细信息，如作者、版本、依赖等。
    ```bash
    modinfo your_module_name
    ```
-   **检查设备信息**：
    -   PCI设备：`lspci -v`
    -   USB设备：`lsusb -v`

### 💡 5. 驱动调试常用技巧
-   **调整内核日志级别**：有时需要调整内核的日志级别以确保显示调试信息。可以通过内核启动参数（如 `loglevel=8`）配置，或在运行时通过 `echo` 命令向 `/proc/sys/kernel/printk` 写入值来调整。
-   **驱动代码中添加调试信息**：在驱动开发中，可以使用 `printk()` 函数（配合适当的日志级别，如 `KERN_DEBUG`），或使用 `dev_dbg()`, `dev_info()` 等宏来输出调试信息。
-   **使用调试工具**：对于更复杂的驱动调试，可以考虑使用：
    -   **ftrace**：内核内置的跟踪工具，用于跟踪内核函数调用。
    -   **kprobes**：可以在内核任意位置插入探测点进行调试。
    -   **perf**：性能分析工具，也可用于分析驱动行为。

### 📊 常用查看方式对比

| 方法               | 主要特点                                                                 | 适用场景                                           |
| :----------------- | :----------------------------------------------------------------------- | :------------------------------------------------- |
| **`dmesg`**        | 直接读取内核环形缓冲区，内容易被新日志覆盖，重启后清空                 | 快速查看近期内核事件，驱动加载初始化调试                 |
| **`journalctl -k`** | 功能强大，支持多种过滤选项（时间、单元、优先级），日志持久化（取决于配置） | 使用 systemd 的系统，需详细查询、过滤和分析历史日志 |
| **查看日志文件**     | 日志持久化存储于磁盘                                           | 需要长期保存或离线分析日志时                         |

### 💎 总结
查看Linux驱动日志最常用的命令是 `dmesg` 和 `journalctl -k`。对于**快速查看当前内核环缓冲区中的驱动相关消息**，`dmesg | grep -i "keyword"` 非常方便。若需**更强大的过滤、查询历史日志或实时监控**，尤其是在使用 `systemd` 的系统中，`journalctl -k` 是更佳选择。直接查看 `/var/log/kern.log` 等日志文件也是一种可靠方式。
